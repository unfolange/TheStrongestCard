var CardButton=pc.createScript("CardButton");CardButton.attributes.add("deckEntity",{type:"entity",description:"The entity that we want to update when the button is clicked"}),CardButton.prototype.initialize=function(){this.entity.button.active=!1,this.app.on("createOtherPlayerEntity",(function(t){this.entity.button.active=!0}),this),this.app.on("loadbalancing:SendCardTaken",(function(t){this.entity.button.active=!1}),this),this.app.on("disconnectPlayer",(function(t){this.entity.button.active=!1,this.app.root.findByName("Welcome").enabled=!0}),this),this.app.on("RestartGame",(function(t){this.entity.button.active=!1}),this),this.entity.button.on("click",(function(t){this.deckEntity.script.deck.setPlayerCard()}),this)};var Deck=pc.createScript("deck");Deck.attributes.add("cardsMaterials",{type:"asset",array:!0}),Deck.prototype.initialize=function(){this.cards=[];for(var a=["Hearts","Diamonds","Clubs","Spades"],e=["2","3","4","5","6","7","8","9","10","Jack","Queen","King","Ace"],t=0;t<a.length;t++)for(var r=0;r<e.length;r++){var o={suit:a[t],value:e[r]};this.cards.push(o)}this.shuffleDeck(),this.deckEntity=this.app.root.findByName("Deck"),this.playerEntity=this.app.root.findByName("Player"),this.otherPlayerEntity=this.app.root.findByName("Other"),this.app.on("CardTakenByPlayer",this.handleCardTook,this),this.app.on("CardTakenByPlayer",this.handleCardTook,this),this.app.on("RestartGame",this.initialize,this)},Deck.prototype.shuffleDeck=function(){for(var a=this.cards.length-1;a>0;a--){var e=Math.floor(Math.random()*(a+1)),t=this.cards[a];this.cards[a]=this.cards[e],this.cards[e]=t}},Deck.prototype.drawCard=function(){return this.cards.length>0?this.cards.pop():(console.warn("El mazo está vacío. Necesitas mezclar y reiniciar."),null)},Deck.prototype.handleCardTook=function(a){console.log("El otro jugador ha tomado una carta",a),this.cards=this.cards.filter((e=>e.value!=a.value||e.suit!=a.suit)),console.log("Baraja despues de carta tomada por el otro jugador",this.cards),this.otherPlayerEntity.script.player2.takeCard(a),this.playerEntity.script.player.hasCard()&&(console.log("Determinando ganador..."),this.determineWinner(this.playerEntity.script.player,this.otherPlayerEntity.script.player2))},Deck.prototype.setPlayerCard=async function(a){var e=this.drawCard();e&&(console.log("El jugador ha tomado una carta:",e),this.playerEntity.script.player.takeCard(e),this.app.fire("loadbalancing:SendCardTaken",e),this.otherPlayerEntity.script.player2.hasCard()&&this.determineWinner(this.playerEntity.script.player,this.otherPlayerEntity.script.player2))},Deck.prototype.sendCard=async function(a){var e=this.drawCard(),t=this.drawCard();e&&t&&(console.log("Se ha tomado una carta:",e),this.playerEntity.script.player.takeCard(e),await this.sleep(5e3),this.CPUEntity.script.cpu.takeCard(t),console.log("Determinando ganador..."),this.determineWinner(this.playerEntity.script.player,this.CPUEntity.script.cpu))},Deck.prototype.sleep=async function(a){return new Promise((e=>setTimeout(e,a)))},Deck.prototype.determineWinner=async function(a,e){console.log("player1"),console.log(a),console.log("player2"),console.log(e);var t=a.card,r=e.card;console.log("cartas vs.",t,r);var o=this.calculateScore(t),s=this.calculateScore(r),i="10"==t.value?t.value.charAt(0).toLowerCase()+t.value.charAt(1).toLowerCase()+t.suit.charAt(0).toLowerCase():t.value.charAt(0).toLowerCase()+t.suit.charAt(0).toLowerCase(),n="10"==r.value?r.value.charAt(0).toLowerCase()+r.value.charAt(1).toLowerCase()+r.suit.charAt(0).toLowerCase():r.value.charAt(0).toLowerCase()+r.suit.charAt(0).toLowerCase();o>s?(e.loseFloor(),this.app.root.findByName("YouWinMessage").enabled=!0,console.log("¡Jugador 1 gana!")):o<s?(a.loseFloor(),this.app.root.findByName("YouLoseMessage").enabled=!0,console.log("Jugador 2 gana!")):(a.loseFloor(),e.loseFloor(),console.log("¡Es un empate!")),a.showCard(this.getVisualRepresentation(i)),e.showCard(this.getVisualRepresentation(n)),await this.sleep(5e3),this.app.root.findByName("YouWinMessage").enabled=!1,this.app.root.findByName("YouLoseMessage").enabled=!1,this.app.fire("disconnectPlayer")},Deck.prototype.calculateScore=function(a){return console.log(a),cardValues={2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,Jack:11,Queen:12,King:13,Ace:14},cardValues[a.value]},Deck.prototype.getVisualRepresentation=function(a){console.log("CARTA RECIBIDa",a),console.log("card",this.cardsMaterials);for(let e=0;e<this.cardsMaterials.length;e++)if(a==this.cardsMaterials[e].name)return console.log("cardsMaterials",this.cardsMaterials[e].name),this.cardsMaterials[e]};const PhotonLoadBalancingPlayCanvas=pc.createScript("PhotonLoadBalancingPlayCanvas");PhotonLoadBalancingPlayCanvas.attributes.add("appId",{type:"string"}),PhotonLoadBalancingPlayCanvas.attributes.add("appVersion",{type:"string",default:"1.0"}),PhotonLoadBalancingPlayCanvas.attributes.add("wss",{type:"boolean",default:!0}),PhotonLoadBalancingPlayCanvas.attributes.add("region",{type:"string",default:"jp",description:"Photon Cloud has servers in several regions, distributed across multiple hosting centers over the world.You can choose optimized region for you.",enum:[{"Select Region":"default"},{"Asia, Singapore":"asia"},{"Australia, Melbourne":"au"},{"Canada, East Montreal":"cae"},{"Chinese Mainland (See Instructions)\tShanghai":"cn"},{"Europe, Amsterdam":"eu"},{"India, Chennai":"in"},{"Japan, Tokyo":"jp"},{"Russia Moscow":"ru"},{"Russia, East Khabarovsk":"rue"},{"South Africa Johannesburg":"za"},{"South America, Sao Paulo":"sa"},{"South Korea, Seoul":"kr"},{"Turkey Istanbul":"tr"},{"USA, East Washington":"us"},{"USA, West San José":"usw"}]}),PhotonLoadBalancingPlayCanvas.prototype.initialize=function(){this.loadBalancingClient=new Photon.LoadBalancing.LoadBalancingClient(this.wss?1:0,this.appId,this.appVersion),this.loadBalancingClient.app=this.app,this.loadBalancingClient.onRoomList=this.onRoomList,this.loadBalancingClient.onJoinRoom=this.onJoinRoom,this.loadBalancingClient.onActorJoin=this.onActorJoin,this.loadBalancingClient.onActorLeave=this.onActorLeave,this.waitingRoom=!1,this.loadBalancingClient.onEvent=this.onEvent,this.app.on("PlayerLoggedIn",this.connectToRegionMaster,this),this.app.on("createOtherPlayerEntity",this.createOtherPlayerEntity,this),this.app.on("loadbalancing:SendCardTaken",this.sendCardTaken,this),this.app.on("disconnectPlayer",this.disconnectPlayer,this)},PhotonLoadBalancingPlayCanvas.prototype.connectToRegionMaster=function(){this.loadBalancingClient.isInLobby()||this.loadBalancingClient.connectToRegionMaster(this.region)},PhotonLoadBalancingPlayCanvas.prototype.sleep=async function(a){return new Promise((n=>setTimeout(n,a)))},PhotonLoadBalancingPlayCanvas.prototype.onRoomList=async function(a){console.log("rooms",a),0===a.length?(this.createRoom(),this.app.fire("PlayerInRoom")):a[0].playerCount<2?(this.joinRoom(a[0].name),this.app.fire("PlayerInRoom")):(this.waitingRoom=!0,console.log("waiting for the room to be empty"),await new Promise((a=>setTimeout(a,1e3))),this.app.fire("PlayerNotInRoom"))},PhotonLoadBalancingPlayCanvas.prototype.onJoinRoom=function(a){this.myRoomActorsArray().forEach((a=>{a.isLocal||this.app.fire("createOtherPlayerEntity",a)}))},PhotonLoadBalancingPlayCanvas.prototype.onActorJoin=function(a){a.isLocal||this.app.fire("createOtherPlayerEntity",a)},PhotonLoadBalancingPlayCanvas.prototype.onActorLeave=function(a){console.log("Actor left ",a);const{actorNr:n}=a,o=this.app.root.findByName("Other");!a.isLocal&&o&&(o.enabled=!1,this.app.fire("RestartGame"))},PhotonLoadBalancingPlayCanvas.prototype.disconnectPlayer=function(){this.loadBalancingClient.disconnect()},PhotonLoadBalancingPlayCanvas.prototype.createOtherPlayerEntity=function(a){const{actorNr:n}=a;this.app.root.findByName("Other").enabled=!0},PhotonLoadBalancingPlayCanvas.prototype.sendCardTaken=function(a){this.loadBalancingClient.raiseEvent(1,{card:a})},PhotonLoadBalancingPlayCanvas.prototype.onEvent=function(a,n,o){switch(a){case 1:this.app.root.findByName("Other")&&this.app.fire("CardTakenByPlayer",n.card);break}};var Player=pc.createScript("player");Player.attributes.add("cardGraphicElement",{type:"entity"}),Player.attributes.add("floor",{type:"entity"}),Player.attributes.add("defaultMaterial",{type:"asset"}),Player.prototype.initialize=function(){this.card=null,this.model3D=this.entity.findByName("Cat"),this.uncoveredCard=!1,this.initCard(),this.floor.enabled=!0,this.app.on("RestartGame",this.initialize,this)},Player.prototype.showPlayer=function(){this.enabled=!0},Player.prototype.getPlayerCardStatus=function(){return null==this.card?"NO_CARD":this.uncoveredCard?this.uncoveredCard?"CARD_UNCOVERED":void 0:"CARD_TAKEN"},Player.prototype.hasCard=function(){return null!=this.card},Player.prototype.takeCard=function(e){this.card=e,this.cardGraphicElement.enabled=!0,console.log("El jugador ha tomado la carta:",this.card)},Player.prototype.showCard=function(e){this.cardGraphicElement.render.materialAssets=[e]},Player.prototype.initCard=function(){this.cardGraphicElement.enabled=!1,this.cardGraphicElement.render.materialAssets=[this.defaultMaterial]},Player.prototype.loseFloor=function(){console.log("lose player 1"),console.log(this.floor.rigidbody.enabled),this.floor.findComponent("collision").enabled=!1,this.floor.findComponent("rigidbody").enabled=!1,this.floor.enabled=!1,console.log("lose player 1 rigidbody"),console.log(this.floor.findComponent("rigidbody").enabled)};var Other=pc.createScript("player2");Other.attributes.add("cardGraphicElement",{type:"entity"}),Other.attributes.add("floor",{type:"entity"}),Other.attributes.add("defaultMaterial",{type:"asset"}),Other.prototype.initialize=function(){this.card=null,this.uncoveredCard=!1,this.initCard(),this.app.on("createOtherPlayerEntity",this.showPlayer),this.app.on("loadbalancing:cardTakenByOtherPlayer",this.takeCard),this.app.on("loadbalancing:otherPlayerCardShowed",this.showCard),this.app.on("RestartGame",this.initialize,this),this.floor.enabled=!0},Other.prototype.showPlayer=function(){this.enabled=!0},Other.prototype.hasCard=function(){return null!=this.card},Other.prototype.takeCard=function(t){this.card=t,this.cardGraphicElement.enabled=!0,console.log("El jugador ha tomado la carta:",this.card)},Other.prototype.showCard=function(t){this.cardGraphicElement.render.materialAssets=[t]},Other.prototype.initCard=function(){this.cardGraphicElement.enabled=!1,this.cardGraphicElement.render.materialAssets=[this.defaultMaterial]},Other.prototype.loseFloor=function(){console.log("lose other"),console.log(this.floor.rigidbody.enabled),this.floor.findComponent("collision").enabled=!1,this.floor.findComponent("rigidbody").enabled=!1,this.floor.enabled=!1,console.log("lose other rigidbody"),console.log(this.floor.findComponent("rigidbody").enabled)};var UiInputField=pc.createScript("uiInputField");UiInputField.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),UiInputField.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),UiInputField.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),UiInputField.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),UiInputField.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),UiInputField.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),UiInputField.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},UiInputField.prototype.setEvents=function(t){this.entity[t]("uiinput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this)},UiInputField.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},UiInputField.prototype._onClick=function(t){this.app.fire("uiinput:clicked",this,t)};"undefined"!=typeof pc?function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,l=null;function onInputFieldClick(e,t){t.stopPropagation(),function showDom(e,t){if(i===e)return;i&&i!==e&&onBlur();i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp));switch(n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}(e,t)}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("uiinput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation()}function onKeyUp(e){e.preventDefault(),e.stopPropagation(),13===e.keyCode&&n.blur()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const l=(e[2].x-e[0].x)/o-20,s=(e[2].y-e[0].y)/o;n.style.width=l+"px",n.style.height=s+"px",n.style.fontSize=Math.round(.5*s)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("uiinput:clicked",onInputFieldClick),l=null}e?l=setTimeout(onIosResizeTimeout,2100):t.on("uiinput:clicked",onInputFieldClick),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!l&&(t.off("uiinput:clicked",onInputFieldClick),l=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}():console.error("PlayCanvas no está definido. Asegúrate de que PlayCanvas se haya cargado correctamente.");var LoginButton=pc.createScript("loginButton");LoginButton.attributes.add("uiParentEntity",{type:"entity",description:"The entity that we want to update when the button is clicked"}),LoginButton.prototype.initialize=function(){this.inputTextMessage=this.app.root.findByName("incorrect"),this.entity.button.on("click",(function(t){usernames=["pepito","pepita"],console.log("ocupado",this.uiParentEntity.findByName("InputText").element.text),usernames.includes(this.uiParentEntity.findByName("InputText").element.text.toLowerCase())?(console.log("Acceso permitido. ¡Bienvenido al juego!"),this.app.fire("PlayerLoggedIn")):(this.inputTextMessage.enabled=!0,console.log("Contraseña incorrecta. Por favor, inténtalo de nuevo."))}),this),this.app.on("PlayerNotInRoom",this.waitForRoom,this),this.app.on("PlayerInRoom",this.startGame,this)},LoginButton.prototype.waitForRoom=function(){console.log("Esperando cuarto..."),this.inputTextMessage.element.text="Waiting in queue...",this.inputTextMessage.enabled=!0,this.app.fire("disconnectPlayer"),this.app.fire("PlayerLoggedIn")},LoginButton.prototype.startGame=function(){console.log("Juego iniciado"),this.uiParentEntity.enabled=!1,this.inputTextMessage.enabled=!1,this.inputTextMessage.element.text="Your password is not correct. Check it out."};